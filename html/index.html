<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Index</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="https://cdn.bootcss.com/twitter-bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdn.bootcss.com/popper.js/1.16.1/esm/popper.min.js"></script>
    <script src="https://cdn.bootcss.com/twitter-bootstrap/4.4.1/js/bootstrap.min.js"></script>
    <script src="https://cdn.staticfile.org/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
</head>

<body style="text-align: center;">
    <div id="showLoading"
        style="display:block;position:absolute;top:0;right:0;left:0;height:2000px;background-color: white;z-index: 1000;">
        Loading...
    </div>
    <nav class="navbar navbar-expand-md navbar-light bg-light border">
        <a class="navbar-brand" href="">IT-Service</a>
        <button aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#navbar" data-toggle="collapse" type="button">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbar">
                <ul class="navbar-nav ml-auto mt-2">
                    <li class="nav-item"><a class="nav-link" href="index-Y1.php">Y1 Entry</a></li>
                    <li class="nav-item"><a class="nav-link" href="index.php">Y234 Entry</a></li>
                    <li class="nav-item"><a class="nav-link" href="">Donation</a></li>
                </ul>
        </div>
    </nav>
    <main class="container p-5 col-sm-12 col-md-10 col-lg-10 col-xl-8">
            <div style="text-align: center;">
                <h4>UNNC timetable to iCalander(ics)<h4>
                        <h5>FOR UNNC Y2,3,4 students<h5>
                                <h5><a style="color: red" href="index-Y1.php">Year 1 Entry(大一入口)</a></h5>
                                <h5 style="color: darkslateblue" data-toggle="modal" data-target="#noticeModal">Click
                                    Here to View Notice</h5>
                                <h5 style="color: darkslateblue" data-toggle="modal" data-target="#myModal">Click Here
                                    to Donate US</h5>
            </div>
            &nbsp;
            <h4>Input Your StudentID here</h4>
            <h6>Example: 20124992</h6>
            <div class="row">
                <div class="container col-10">
                    <input type="text" class="form-control" placeholder="your team id" name="studentid" id="userid"
                        oninput="avoidIncorrectInput()" maxlength='8' />
                </div>
            </div>
            &nbsp;
            <div class="row">
                <div class="container col-1"></div>
                <div class="container col-6">
                    <h5 style="display: inline-block;margin-bottom: auto;vertical-align: middle;">Set Notify(minutes):</h5>
                </div>
                <div class="container col-4">
                    <input type="text" class="form-control" placeholder="No Alarm" name="alarmtime" id="alarmtime" oninput="avoidIncorrectInput()" maxlength='3'/>
                </div>
                <div class="container col-1"></div>
            </div>
            &nbsp;
            <div class="container col-10">
                <input id="ck1" class="custom-control-input" type="checkbox" name="checkIgnore" checked="checked"/>
                <label class="custom-control-label" for="ck1">The timetable has changed since last generate</label>
            </div>
            &nbsp;
            <div class="container col-10">
                <button class="btn btn-primary" style="width: 100%;" type="button" id="genelink"
                    onclick="test();">DownLoad ics File</button>
            </div>
            &nbsp;
        <h5>Finally, if something went wrong with the iCalander file generated by this system, let me know.</h5>
        <h5>you can contact me at: sqycz1@nottingham.edu.cn</h5>
    </main>

    <div style="text-align: center;">
        <h5 style="color: darkslateblue" data-toggle="modal" data-target="#myModal">
            Click Here to Donate US
        </h5>
        <h6><span style="font-family:arial;">Copyright &copy; 2019 corsaircat.com</span></h6>
    </div>

    <div id="showOut" style="display:none;position:absolute;top:0;right:0;left:0;height:2000px;background-color: white">
        您正在通过微信浏览器或qq浏览器打开
        <br>
        You are using Wechat Or QQ browser to open this page
        <br>
        请点击右上角在系统浏览器(Chrome, Safari或Firefox)中打开
        <br>
        please click the button on top right corner and open it in another browser(example: Chrome, Safari or Firefox)
    </div>

    <!-- 模态框 -->
    <div class="modal fade" id="myModal">
        <div class="modal-dialog">
            <div class="modal-content">

                <!-- 模态框头部 -->
                <div class="modal-header">
                    <h4 class="modal-title">捐赠我们</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>

                <!-- 模态框主体 -->
                <div class="modal-body">
                    <img src="img/donation1.jpg" style="width: 90%;" />
                </div>

                <!-- 模态框底部 -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                </div>

            </div>
        </div>
    </div>

    <div class="modal fade" id="noticeModal">
        <div class="modal-dialog">
            <div class="modal-content">

                <!-- 模态框头部 -->
                <div class="modal-header">
                    <h4 class="modal-title">Some Infomation</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>

                <!-- 模态框主体 -->
                <div class="modal-body">
                    <p>ATTENTION: Due to our progrem, the calendar would be saved on this serve for less computing; if
                        you are sure that the timetable has changed, please click at the check box below the id input
                    </p>
                </div>

                <!-- 模态框底部 -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                </div>

            </div>
        </div>
    </div>

</body>
<script type="text/javascript">
    function avoidIncorrectInput() {
        var inputVal = "#userid";
        if (isNaN($(inputVal).val())) {
            $(inputVal).val($(inputVal).val().replace(/[^0-9]/g, ''));
        }
    }
    function test() {
        console.log("!!!!");
        var inputVal = "#userid";
        var studentId = $(inputVal).val();
        var patt = /^[0-9]{8}$/;
        var patty1 = /^[2][0][2][1][0-9]{4}$/;
        var obj = document.getElementById("ck1");
        if (patt.test(studentId)) {
            if (!patty1.test(studentId)) {
                var link = "index.php?userid=" + studentId;
                if ($("#alarmtime").val() != ""){
                    link = link + "&notifytime=" + $("#alarmtime").val();
                }
                if (obj.checked) {
                    link = link + "&ignoreLocal=owjs91";
                    console.log(link);
                } else {
                    console.log(link);
                }
                window.location.href = link;
            } else {
                alert("Y1 student please go to the red link on page!!!");
                $(inputVal).val("");
            }
        } else {
            alert("it is not a student id, please check");
            $(inputVal).val("");
        }
    }

    function is_weixin() {
        var ua = navigator.userAgent.toLowerCase();
        if (ua.match(/MicroMessenger/i) == "micromessenger") {
            return true;
        } else {
            return false;
        }
    }

    function isQQ() {
        var ua = window.navigator.userAgent.toLowerCase();
        if (ua.match(/QQ/i) == 'qq') {
            return true;
        } else {
            return false;
        }
    }

    window.onload = function () {
        var flag = 0;
        if (is_weixin()) {
            document.getElementById("showOut").style.display = "block";
            flag = 1;
        }
        if (isQQ()) {
            document.getElementById("showOut").style.display = "block";
            flag = 1;
        }
        document.getElementById("showLoading").style.display = "none";
    }

</script>

</html>